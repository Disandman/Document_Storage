# Ревью от 17.08.2021

## Тесты

Новых тестов не увидела, поэтому дельше не проверяла. По текущему ОК.

## API

### Именование модуля и построение ссылок

Мдуль для API лучше так и назвать - api. А внутри него уже можно сделать разные версии - v1, v2...

Т.о. api будет доступен по ссылкам вида:

```
https://site.com/api/v1/uploads
https://site.com/api/v1/users
...
```

Набросала структуру в modules для примера.

### Фильтры

Сразу плюс в карму за `contentNegotiator`) В окружающих меня системах обычно используется JSON, но 
знание, что Yii из коробки умеет формировать разные ответы - это хорошо.

По `verb-фильтрам` увидела, что нет фильтра POST-запроса, но есть PUT. Что-то не получилось сделать с ним? 

Ещё надо попробовать сделать метод HEAD. Этот тот же GET, только в отличие от него возращается только заголовки. 

### Метод PUT заменил метод POST

Это не верно с т.з. спефицикации REST-а. 

PUT - меняет поля объекта, обновляет данные. При этом сам объект остается тот же.

POST - создает новый объект по переданным данным. 

В данном случае что-то всё смешалось.

### Возращаемые значения

Методы, которые изменяют данные, должны возвращать статус операции. Поправила `actionDelete` для примера.

### Базовый контроллер для API

Увидела, что есть контроллер `BaseApiController`. Я бы его положила в папку к остальным контроллерам API. 
Всё-таки он часть функционала API. 

В components, по опыту, обычно добавляют компоненты, которые переопределяют пакетные решения (н-р, если захочется переопределить функционал в классах dektrium). Т.е. влезть в чужой компонент ты не можешь, но вот если очень надо что-то переделать - утаскиваешь себе в components.

## Прочее

### OAuth2 авторизация

На демо сайте не работает, во всплывающем окошке что-то не то.

### Пути к файлу

Давайте заменим конструкции `$_ENV['DOWNLOAD_PATH'] . $modelDel->name` на метод, который будет путь возвращать? В модели Upload можно добавить статический метод:

```php
/**
 * Возвращает путь к файлу
 * 
 * @param string $name
 * @return string
 * */
public static function getPathToFile(string $name): string {
    return $_ENV['DOWNLOAD_PATH'] . $name;
}

```

### Коммиты в гите

Это рекомендация. Я посмотрела историю коммитов и увидела целый столбец из сообщений `Update ApiController.php`. Лучше стараться такого избегать.

Если есть проблема с английским, пишите коммиты на русском. В 80% случаев код в российских компаниях остаётся в России, так что можно с этим не заморачиваться. 

### Конфигурации

clientId и clientSecret для гитлаба тоже лучше спрятать в .env


<p align="center">
    <a href="https://github.com/yiisoft" target="_blank">
        <img src="https://avatars0.githubusercontent.com/u/993323" height="100px">
    </a>
    <h1 align="center">Приложение для хранения документов на PHP (https://projectsil.ru)</h1>
    <h3 align="center">Необходимо разработать приложение, которое позволит организовывать хранение документов с различными разрешениями.</h3>
</p>


Требования к функционалу:
-------------------

○ Документы должны делиться на публичные (доступны «гостям»), условно-приватные (доступны авторизированным пользователям) и приватные (доступны только загрузившему пользователю).
</br>
○ Необходимо предусмотреть функционал авторизации и регистрации.
</br>
○ Необходимо вести некоторую статистику:
</br>
   − Сколько документов загружено в день / месяц / год
</br>
   − Соотношение публичных, условно-приватных и приватных документов за выбранный интервал времени.
</br>
○ Бекэнд должен быть написан на Yii2

Роли в системе:
-------------------

○ Гость – неавторизованный посетитель системы. Может просматривать публичные документы.
</br>
○ Необходимо предусмотреть функционал авторизации и регистрации.
</br>
○ Пользователь – посетитель, имеющий учетную запись в системе и авторизованный в ней. Может загружать свои документы, настраивать их приватность; просматривать публичные, условно-приватные и свои документы.
</br>
○ Администратор – пользователь, имеющий права на просмотр всех файлов и на управление другими пользователями.
INSTALLATION

Дополнительно (по желанию):
-------------------
○ Написание простых unit или acceptance тестов.
