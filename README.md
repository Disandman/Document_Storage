# Ревью от 21.08.2021

Выглядит очень красиво, но не без косяков))

## Иконки (не ошибка)

Первое, что бросилось в глаза - иконки. Почему svg а не [шрифт Font Awesome](https://github.com/rmrevin/yii2-fontawesome), например?) 

Или, если svg, то можно их файлами хранить, они же стандартые.

Повторюсь, использование их прямо так - это не ошибка, просто мне интересно.

## Постраничная навигация

Не работает. 

https://projectsil.ru/upload/index?page=1 и https://projectsil.ru/upload/index?page=2 отдают одни и не же файлы.

Почему это происходит и как пофиксить - оставила комментарии в коде.

## 100500 раз инициация модели

Заметила, что очень часто повторяются в рамках одного метода обращения:

```php
$this->findModel($id)->name
```

Не надо так делать, если это не преследует какую-то определенную цель. Лучше один раз получить модель и дальше с ней работать:

```php
$model = $this->findModel($id);
// ...
$model->name;
// ...
$model->id;
// ...
```

## Проверки на наличие файла?

Не совсем поняла, что означаю эти проверки:

```php
if(!Upload::getPathToFile($this->findModel($id)->name)) { /* ... */ }
```

Если это проверка на наличие файла на диске, то делать это нужно так:

```php
$file = Upload::getPathToFile($this->findModel($id)->name);
if(!file_exists($file)) { /* ... */  }
```

## Switch с типами файла

Я бы посоветовала сделать 2 вещи:

1. Перенести поиск картинки в функцию, а эту функцию определить в модели Upload
2. preg_match довольно "прожорливая" функция, не стоит её так часто использовать. Лучше не проверять наличие расширения, а сделать такую регулярку:

```php
$name = 'тестовое_имя.jpg';
$matches = []; // массив для поиска совпадений по группе в регулярке

preg_match('/.*\.(.*)$/iu', $name, $matches); // "вытаскиваем" из имени файла его расширение

// Объяснение регулярки:
// .* - взять 1 и более символов
// \. - пока не встретится последняя точка (точку экранируем, т.к. в регулярках точка == 1 символ). Последняя точка - потому что перед этом выборка "жадная".
// (.*)$ - вытащить подгруппу сиволов до конца ($) строки. Скобки - признак подгруппы, которую мы ищем.
// iu - флаги. i - без учета регистра, u - с поддержкой unicode

$extension = isset($matches[1]) ? $matches[1] : ''; // В $matches[0] будет исходная строка, в $matches[1] - первая группа, $matches[2] - вторая группа и т.д.

// а тут уже просто по расширению отдаем картинку
switch($extension) {
    case 'jpg': // ...
        break;
}

```

В остальном замечаний по последней доработке у меня нет)

<p align="center">
    <a href="https://github.com/yiisoft" target="_blank">
        <img src="https://avatars0.githubusercontent.com/u/993323" height="100px">
    </a>
    <h1 align="center">Приложение для хранения документов на PHP (https://projectsil.ru)</h1>
    <h3 align="center">Необходимо разработать приложение, которое позволит организовывать хранение документов с различными разрешениями.</h3>
</p>


Требования к функционалу:
-------------------

○ Документы должны делиться на публичные (доступны «гостям»), условно-приватные (доступны авторизированным пользователям) и приватные (доступны только загрузившему пользователю).
</br>
○ Необходимо предусмотреть функционал авторизации и регистрации.
</br>
○ Необходимо вести некоторую статистику:
</br>
   − Сколько документов загружено в день / месяц / год
</br>
   − Соотношение публичных, условно-приватных и приватных документов за выбранный интервал времени.
</br>
○ Бекэнд должен быть написан на Yii2

Роли в системе:
-------------------

○ Гость – неавторизованный посетитель системы. Может просматривать публичные документы.
</br>
○ Необходимо предусмотреть функционал авторизации и регистрации.
</br>
○ Пользователь – посетитель, имеющий учетную запись в системе и авторизованный в ней. Может загружать свои документы, настраивать их приватность; просматривать публичные, условно-приватные и свои документы.
</br>
○ Администратор – пользователь, имеющий права на просмотр всех файлов и на управление другими пользователями.
INSTALLATION

Дополнительно (по желанию):
-------------------
○ Написание простых unit или acceptance тестов.
